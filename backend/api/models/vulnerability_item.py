from django.db import models
from api.models.compliance import ComplianceArea

class VulnerabilityItem(models.Model):
    id = models.IntegerField(default=1)
    category = models.CharField('구분', max_length=100, blank=False)
    area_alias = models.CharField('평가분야', max_length=100, blank=False)
    domain = models.CharField('통제분야', max_length=100, blank=False)
    group_1 = models.CharField('통제구분(대)', max_length=100, blank=False)
    group_2 = models.CharField('통제구분(중)', max_length=100, blank=False)
    group_3 = models.CharField('통제구분(소)', max_length=100, blank=False)
    code = models.CharField('취약점 코드', max_length=100, blank=False)
    full_code = models.CharField('취약점 전체 코드', max_length=100, blank=False, primary_key=True, unique=True)
    compliance_area_type = models.ForeignKey('ComplianceArea', on_delete=models.CASCADE, default=None)
    alias = models.CharField('취약점 별칭', max_length=100, blank=False)
    name = models.TextField('취약점명', blank=False)
    type = models.CharField('취약점 구분', max_length=100, blank=False)
    platform = models.CharField('자산종류', default="NONE", max_length=100, blank=True)
    gubun = models.CharField('항목상세구분', default="", max_length=100, blank=True)
    is_server = models.BooleanField('서버측 점검 여부', default=False)
    raw_name = models.TextField('조항', blank=True)
    raw_con = models.TextField('조항내용', blank=True)
    guide = models.TextField('가이드', blank=True)
    is_https = models.BooleanField('HTTPS', default=False)
    is_financial = models.BooleanField('전자금융', default=False)
    is_switch = models.BooleanField('스위치여부', blank=True, default=False)
    is_router = models.BooleanField('라우터여부', blank=True, default=False)
    default_status = models.TextField('현재상태 기본값', blank=True)
    risk = models.IntegerField('위험도', blank=True, default=0)
    cii_risk_1 = models.IntegerField('주요정보통신기반시설_위험도1', blank=True, default=0)
    cii_risk_2 = models.IntegerField('주요정보통신기반시설_위험도2', blank=True, default=0)
    cii_raw_con_1 = models.TextField('주요정보통신기반시설1', blank=True)
    cii_raw_con_2 = models.TextField('주요정보통신기반시설2', blank=True)
    description = models.TextField('취약점 설명', blank=True)
    checking_guide = models.TextField('취약점 점검방법', blank=True)
    judgment_guide = models.TextField('취약점 판단기준', blank=True)
    solution = models.TextField('취약점 조치방법', blank=True)
    compliance = models.TextField('평가기준', blank=True)
    sorting_id = models.IntegerField(default=0)

    class Meta:
        ordering = ['full_code']

    def __str__(self):
        return f'[{self.code}] {self.name}'
